# MinIO Enterprise Backup Configuration
# Version: 1.0.0
# Description: Configuration file for backup and restore scripts

# ============================================================================
# BACKUP SETTINGS
# ============================================================================

# Backup directory (where backups will be stored)
BACKUP_DIR="/var/backups/minio"

# Backup retention in days (older backups will be automatically deleted)
BACKUP_RETENTION_DAYS=7

# Backup compression: gzip, bzip2, xz, or none
BACKUP_COMPRESSION="gzip"

# Backup encryption settings
BACKUP_ENCRYPTION_ENABLED=false
# IMPORTANT: Store encryption key securely (environment variable recommended)
# Example: export BACKUP_ENCRYPTION_KEY="your-secure-key-here"
BACKUP_ENCRYPTION_KEY="${BACKUP_ENCRYPTION_KEY:-}"

# ============================================================================
# POSTGRESQL SETTINGS
# ============================================================================

POSTGRES_HOST="localhost"
POSTGRES_PORT=5432
POSTGRES_USER="minio"
POSTGRES_DB="minio"
# IMPORTANT: Store password securely (environment variable recommended)
# Example: export POSTGRES_PASSWORD="your-password-here"
POSTGRES_PASSWORD="${POSTGRES_PASSWORD:-}"

# ============================================================================
# REDIS SETTINGS
# ============================================================================

REDIS_HOST="localhost"
REDIS_PORT=6379
# IMPORTANT: Store password securely (environment variable recommended)
# Example: export REDIS_PASSWORD="your-password-here"
REDIS_PASSWORD="${REDIS_PASSWORD:-}"

# Redis data directory (where dump.rdb is stored)
REDIS_DATA_DIR="/var/lib/redis"

# ============================================================================
# MINIO SETTINGS
# ============================================================================

# MinIO data directory (object storage location)
MINIO_DATA_DIR="/var/lib/minio"

# MinIO configuration directory
MINIO_CONFIG_DIR="/etc/minio"

# ============================================================================
# S3 BACKUP SETTINGS (Optional - for offsite backups)
# ============================================================================

# Enable S3 backup (copies backup to S3-compatible storage)
S3_BACKUP_ENABLED=false

# S3 bucket name
S3_BUCKET=""

# S3 endpoint (e.g., https://s3.amazonaws.com or https://minio.example.com)
S3_ENDPOINT=""

# S3 credentials
# IMPORTANT: Store credentials securely (environment variables recommended)
# Example: export S3_ACCESS_KEY="your-access-key"
# Example: export S3_SECRET_KEY="your-secret-key"
S3_ACCESS_KEY="${S3_ACCESS_KEY:-}"
S3_SECRET_KEY="${S3_SECRET_KEY:-}"

# ============================================================================
# NOTIFICATION SETTINGS (Optional)
# ============================================================================

# Enable notifications on backup/restore completion
NOTIFICATION_ENABLED=false

# Webhook URL for notifications (Slack, Discord, custom webhook, etc.)
# Example Slack webhook: https://hooks.slack.com/services/YOUR/WEBHOOK/URL
NOTIFICATION_WEBHOOK=""

# ============================================================================
# LOGGING SETTINGS
# ============================================================================

# Log file location
LOG_FILE="${BACKUP_DIR}/backup.log"

# ============================================================================
# RESTORE SETTINGS
# ============================================================================

# Temporary directory for restore operations
RESTORE_TEMP_DIR="/tmp/minio_restore"

# ============================================================================
# ADVANCED SETTINGS
# ============================================================================

# Rsync options for MinIO data backup (advanced users only)
# RSYNC_OPTS="-av --delete"

# PostgreSQL dump format: plain, custom, directory, tar
# PG_DUMP_FORMAT="plain"

# ============================================================================
# DOCKER-SPECIFIC SETTINGS (if running in Docker)
# ============================================================================

# If running MinIO in Docker, adjust paths accordingly:
# MINIO_DATA_DIR="/docker/volumes/minio-data/_data"
# REDIS_DATA_DIR="/docker/volumes/redis-data/_data"

# ============================================================================
# KUBERNETES-SPECIFIC SETTINGS (if running in Kubernetes)
# ============================================================================

# For Kubernetes deployments, consider using:
# - Velero for cluster backups
# - PV snapshots for persistent volumes
# - This script can still be used via CronJob

# ============================================================================
# EXAMPLE CONFIGURATIONS
# ============================================================================

# Example 1: Local backups with encryption
# BACKUP_DIR="/var/backups/minio"
# BACKUP_ENCRYPTION_ENABLED=true
# BACKUP_ENCRYPTION_KEY="${BACKUP_ENCRYPTION_KEY}"  # Set via environment

# Example 2: Local + S3 offsite backups
# BACKUP_DIR="/var/backups/minio"
# S3_BACKUP_ENABLED=true
# S3_BUCKET="minio-backups"
# S3_ENDPOINT="https://s3.amazonaws.com"
# S3_ACCESS_KEY="${AWS_ACCESS_KEY_ID}"
# S3_SECRET_KEY="${AWS_SECRET_ACCESS_KEY}"

# Example 3: Minimal local backup (testing/development)
# BACKUP_DIR="/tmp/minio-backups"
# BACKUP_RETENTION_DAYS=3
# BACKUP_COMPRESSION="gzip"
# BACKUP_ENCRYPTION_ENABLED=false

# ============================================================================
# SECURITY NOTES
# ============================================================================

# 1. This file may contain sensitive information. Protect it:
#    chmod 600 /path/to/backup.conf
#    chown root:root /path/to/backup.conf

# 2. Use environment variables for sensitive data instead of hardcoding:
#    export POSTGRES_PASSWORD="secret"
#    export BACKUP_ENCRYPTION_KEY="encryption-key"
#    export S3_SECRET_KEY="s3-secret"

# 3. For production, consider using a secrets management system:
#    - HashiCorp Vault
#    - AWS Secrets Manager
#    - Kubernetes Secrets
#    - Docker Secrets

# 4. Rotate encryption keys and database passwords regularly

# 5. Test backups regularly to ensure they can be restored

# ============================================================================
# CRON SCHEDULE EXAMPLES
# ============================================================================

# Daily full backup at 2 AM:
# 0 2 * * * /path/to/backup.sh full --config=/path/to/backup.conf

# Incremental backup every 6 hours:
# 0 */6 * * * /path/to/backup.sh incremental --config=/path/to/backup.conf

# Weekly full backup on Sunday at 3 AM:
# 0 3 * * 0 /path/to/backup.sh full --config=/path/to/backup.conf

# Daily incremental backup at 2 AM (Monday-Saturday):
# 0 2 * * 1-6 /path/to/backup.sh incremental --config=/path/to/backup.conf
